<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>守望先锋 彩色文字生成器 Pro</title>
    <style>
        :root {
            --bg-color: #0d0221;
            --primary-color: #00f6ff;
            --secondary-color: #ff00ff;
            --tertiary-color: #52ff00;
            --text-color: #f0f0f0;
            --border-glow: 0 0 3px var(--primary-color), 0 0 8px var(--primary-color), 0 0 15px var(--primary-color);
            --border-glow-secondary: 0 0 3px var(--secondary-color), 0 0 8px var(--secondary-color), 0 0 15px var(--secondary-color);
            --font-family: 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', sans-serif;
            --font-mono: 'Consolas', 'Courier New', monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            margin: 0;
            padding: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 700px;
            background: rgba(13, 2, 33, 0.8);
            border: 1px solid var(--primary-color);
            box-shadow: var(--border-glow);
            padding: 2em;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            text-shadow: 0 0 5px var(--primary-color), 0 0 10px var(--primary-color);
            margin-bottom: 1em;
            letter-spacing: 2px;
        }

        /* Mode Tabs */
        .mode-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }

        .mode-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .mode-tab:hover {
            background: rgba(0, 246, 255, 0.1);
        }

        .mode-tab.active {
            border-color: var(--primary-color);
            background-color: #1a0c33;
            color: var(--primary-color);
            font-weight: bold;
        }

        .mode-panel {
            display: none;
        }

        .mode-panel.active {
            display: block;
        }

        .segment-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .segment-row {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #333;
            transition: all 0.3s ease;
        }

        .segment-row.active-row {
            border-color: var(--secondary-color);
            box-shadow: var(--border-glow-secondary);
        }

        .segment-row input[type="checkbox"] {
            appearance: none;
            width: 20px;
            height: 20px;
            border: 2px solid var(--primary-color);
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }

        .segment-row input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            box-shadow: var(--border-glow);
        }

        .segment-row input[type="checkbox"]:checked::after {
            content: '✔';
            color: var(--bg-color);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            font-weight: bold;
        }

        .color-swatch {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #555;
            transition: transform 0.2s;
            flex-shrink: 0;
        }

        .color-swatch:hover {
            transform: scale(1.1);
        }

        .text-input {
            flex-grow: 1;
            background-color: #1a0c33;
            border: 1px solid #444;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 1em;
            transition: all 0.3s ease;
            min-height: 22px;
            line-height: 22px;
            outline: none;
        }

        .text-input:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 5px var(--secondary-color);
        }

        .text-input:empty:before {
            content: attr(placeholder);
            color: #666;
            pointer-events: none;
        }

        .emoji-code-inline {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-color);
            padding: 2px 4px;
            border-radius: 4px;
            font-family: var(--font-mono);
            font-size: 0.9em;
            display: inline-block;
            margin: 0 2px;
            user-select: none;
        }

        .segment-actions button {
            background: transparent;
            border: 1px solid var(--tertiary-color);
            color: var(--tertiary-color);
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .segment-actions button.remove-btn {
            border-color: var(--secondary-color);
            color: var(--secondary-color);
        }

        .segment-actions button:hover {
            background-color: var(--tertiary-color);
            color: var(--bg-color);
            box-shadow: 0 0 5px var(--tertiary-color);
        }

        .segment-actions button.remove-btn:hover {
            background-color: var(--secondary-color);
            box-shadow: 0 0 5px var(--secondary-color);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 25px;
            margin-bottom: 25px;
        }

        .main-btn {
            background: transparent;
            border: 2px solid;
            padding: 10px 25px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            letter-spacing: 1px;
        }

        #generate-btn {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        #generate-btn:hover {
            background-color: var(--primary-color);
            color: var(--bg-color);
            box-shadow: var(--border-glow);
        }

        #emoji-btn {
            color: var(--tertiary-color);
            border-color: var(--tertiary-color);
        }

        #emoji-btn:hover {
            background-color: var(--tertiary-color);
            color: var(--bg-color);
            box-shadow: 0 0 5px var(--tertiary-color);
        }

        .output-container {
            margin-top: 20px;
        }

        .output-container label {
            color: var(--primary-color);
            font-weight: bold;
        }

        #output-text {
            background-color: #111;
            border: 1px dashed #555;
            padding: 15px;
            border-radius: 5px;
            word-wrap: break-word;
            min-height: 50px;
            margin-top: 10px;
            line-height: 22px;
        }

        #copy-status {
            color: var(--tertiary-color);
            font-weight: bold;
            text-align: center;
            display: block;
            margin-top: 10px;
            height: 20px;
            transition: opacity 0.5s;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--bg-color);
            margin: 10% auto;
            padding: 25px;
            border: 1px solid var(--secondary-color);
            box-shadow: var(--border-glow-secondary);
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
            position: relative;
        }

        .modal-close {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-close:hover,
        .modal-close:focus {
            color: var(--text-color);
        }

        #color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .preset-color {
            cursor: pointer;
            text-align: center;
        }

        .preset-color-box {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            margin: 0 auto 5px;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .preset-color:hover .preset-color-box {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .custom-color-section {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #444;
        }

        .custom-color-section input[type="color"] {
            width: 50px;
            height: 50px;
            border: none;
            background: none;
            padding: 0;
            cursor: pointer;
        }

        .emoji-modal-content h2 {
            color: var(--tertiary-color);
            text-align: center;
        }

        .emoji-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            border-bottom: 1px solid var(--primary-color);
            margin-bottom: 20px;
        }

        .emoji-tab {
            padding: 10px 15px;
            cursor: pointer;
            border: 1px solid transparent;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            transition: all 0.3s;
        }

        .emoji-tab:hover {
            background: rgba(0, 246, 255, 0.1);
        }

        .emoji-tab.active {
            border-color: var(--primary-color);
            background-color: var(--bg-color);
            color: var(--primary-color);
            font-weight: bold;
        }

        .emoji-panel {
            display: none;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            max-height: 40vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .emoji-panel.active {
            display: grid;
        }

        .emoji-item {
            background: #1a0c33;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: background-color 0.2s;
            border: 1px solid #333;
        }

        .emoji-item:hover {
            background-color: var(--secondary-color);
            color: var(--bg-color);
        }

        .emoji-item .emoji-code {
            font-family: var(--font-mono);
            font-size: 11px;
            opacity: 0.7;
            display: block;
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>守望先锋 彩色文字生成器 Pro</h1>
        <h2>❤️小红书ID:1135655410❤️</h2>
        <h2>免费发布，付费 = 上当</h2>
        <!--复用创意的请和我说一下-->
        <div class="mode-tabs">
            <div class="mode-tab active" data-mode="custom">自定义模式 😎</div>
            <div class="mode-tab" data-mode="random">疯狂随机模式 🤡</div>
        </div>

        <div id="custom-mode-panel" class="mode-panel active">
            <div id="segment-list" class="segment-list"></div>
        </div>

        <div id="random-mode-panel" class="mode-panel">
            <div id="random-input-container" class="segment-row">
                <div id="random-text-input" class="text-input" contenteditable="true" placeholder="在此输入文字，然后点击生成..."
                    style="color: var(--text-color);"></div>
            </div>
        </div>

        <div class="controls">
            <button id="generate-btn" class="main-btn">生成并复制</button>
            <button id="emoji-btn" class="main-btn">插入表情</button>
        </div>
        <div class="output-container">
            <label for="output-text">生成结果:</label>
            <div id="output-text"></div>
        </div>
        <div id="copy-status"></div>
    </div>

    <!-- Modals -->
    <div id="color-modal" class="modal">
        <div class="modal-content"><span class="modal-close" id="color-modal-close">&times;</span>
            <h2>选择颜色</h2>
            <div id="color-grid"></div>
            <div class="custom-color-section"><label>自定义颜色:</label><input type="color" id="custom-color-picker"
                    value="#ff1493"><span id="custom-color-code">#ff1493</span></div>
        </div>
    </div>
    <div id="emoji-modal" class="modal">
        <div class="modal-content emoji-modal-content"><span class="modal-close" id="emoji-modal-close">&times;</span>
            <h2>选择表情或图标</h2>
            <div class="emoji-tabs" id="emoji-tabs"></div>
            <div id="emoji-panels"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            const presetColors = {
                "正红": "FF0000",      // 纯红，经典红色起点
                "樱桃红": "DC143C",   // 温暖的深红
                "亮粉": "FF1493",     // 原有颜色，粉红
                "淡粉": "FC9ACD",     // 原有颜色，柔和粉
                "玫瑰红": "C71585",   // 偏紫的深粉
                "紫红": "800080",     // 经典紫红
                "紫色": "A231B3",     // 原有颜色，鲜艳紫
                "深紫": "4B0082",     // 浓郁的靛紫
                "靛蓝": "483D8B",     // 偏冷的深蓝紫
                "深蓝": "2313BB",     // 原有颜色，鲜艳深蓝
                "宝蓝": "4169E1",     // 明亮皇家蓝
                "天蓝": "87CEEB",     // 清新的天空蓝
                "青色": "53D7B6",     // 原有颜色，青绿
                "碧蓝": "00CED1",     // 明亮的青蓝
                "海蓝": "20B2AA",     // 海洋般的蓝绿
                "孔雀绿": "008B8B",   // 深青绿
                "亮绿": "53D760",     // 原有颜色，鲜艳绿
                "草绿": "B0DF22",     // 原有颜色，草本绿
                "橄榄绿": "6B8E23",   // 自然的橄榄色
                "森林绿": "228B22",   // 深沉的森林绿
                "黄绿": "9ACD32",     // 明亮的黄绿
                "柠檬黄": "FFFACD",   // 柔和的浅黄
                "黄色": "F4E607",     // 原有颜色，鲜艳黄
                "金黄": "FFD700",     // 温暖的金色
                "橙黄": "FFA500",     // 经典橙黄
                "橙色": "F47C07",     // 原有颜色，鲜艳橙
                "珊瑚橙": "FF7F50",   // 柔和的珊瑚色
                "番茄红": "FF6347",   // 偏橙的暖红
                "白色": "FFFFFF",     // 原有颜色，纯白
                "灰色": "808080",     // 原有颜色，中灰
                "黑色": "000000",    //纯黑
                "light_salmon": "FFA07A",
                "salmon": "FA8072",
                "dark_salmon": "E9967A",
                "light_coral": "F08080",
                "indian_red": "CD5C5C",
                "crimson": "DC143C",
                "firebrick": "B22222",
                // 红色系
                "pink": "FFC0CB",
                "light_pink": "FFB6C1",
                "hot_pink": "FF69B4",
                "deep_pink": "FF1493",
                "medium_violet_red": "C71585",
                // 粉色/紫红系
                "light_cyan": "E0FFFF",
                "pale_turquoise": "AFEEEE",
                "aquamarine": "7FFFD4",
                "turquoise": "40E0D0",
                "cyan": "00FFFF",
                "dark_cyan": "008B8B",
                // 青/蓝系
                "light_blue": "ADD8E6",
                "sky_blue": "87CEEB",
                "steel_blue": "4682B4",
                "royal_blue": "4169E1",
                "medium_slate_blue": "7B68EE",
                "slate_blue": "6A5ACD",
                // 蓝紫系
                "lavender": "E6E6FA",
                "thistle": "D8BFD8",
                "plum": "DDA0DD",
                "violet": "EE82EE",
                "magenta": "FF00FF",
                "purple": "800080",
                "rebeccapurple": "663399",
                // 紫色系
                "light_green": "90EE90",
                "lime_green": "32CD32",
                "forest_green": "228B22",
                "olive_drab": "6B8E23",
                "dark_olive_green": "556B2F",
                "yellow_green": "9ACD32",
                // 绿系
                "gold": "FFD700",
                "khaki": "F0E68C",
                "lemon_chiffon": "FFFACD",
                "pale_goldenrod": "EEE8AA",
                "light_goldenrod_yellow": "FAFAD2",
                // 黄/橙系
                "moccasin": "FFE4B5",
                "peach_puff": "FFDAB9",
                "coral": "FF7F50",
                "tomato": "FF6347",
                "orange_red": "FF4500",
                "dark_orange": "FF8C00",
                "orange": "FFA500",
                // 橙红系
                "beige": "F5F5DC",
                "wheat": "F5DEB3",
                "burlywood": "DEB887",
                "tan": "D2B48C",
                "rosy_brown": "BC8F8F",
                "sienna": "A0522D",
                "brown": "A52A2A",
                // 棕系
                "gainsboro": "DCDCDC",
                "light_gray": "D3D3D3",
                "silver": "C0C0C0",
                "dark_gray": "A9A9A9",
                "dim_gray": "696969",
                "gray": "808080",
                "dark_slate_gray": "2F4F4F",
                "black": "000000",
                // 灰黑
                "white_smoke": "F5F5F5",
                "alice_blue": "F0F8FF",
                "ghost_white": "F8F8FF",
                "floral_white": "FFFAF0",
                "mint_cream": "F5FFFA",
                "azure": "F0FFFF",
                // 白系淡色

            };
            const presetColorValues = Object.values(presetColors);

            // ===== DATA UPDATE =====
            const emojis = {
                "常用表情": [{ name: "爱心 ❤️", code: "<tx0C00000000017112>" }, { name: "点赞 👍", code: "<tx0C00000000005A0D>" }, { name: "招手 👋", code: "<tx0C00000000005A0B>" }, { name: "难过 😔", code: "<tx0C0000000002A9FE>" }, { name: "警告 ⚠️", code: "<tx0C00000000005A0C>" }, { name: "叉 ❌", code: "<tx0C0000000002A9F9>" }],
                "英雄图标": [{ name: "天使", code: "<tx0C00000000038C39>" }, { name: "安娜", code: "<tx0C00000000038C3C>" }, { name: "Dva", code: "<tx0C00000000038C19>" }, { name: "铁拳", code: "<tx0C00000000038C1A>" }, { name: "女王", code: "<tx0C00000000038C1B>" }, { name: "奥丽莎", code: "<tx0C00000000038C1C>" }, { name: "老玛", code: "<tx0C00000000038C1D>" }, { name: "大锤", code: "<tx0C00000000038C1E>" }, { name: "路霸", code: "<tx0C00000000038C1F>" }, { name: "猩猩", code: "<tx0C00000000038C25>" }, { name: "仓鼠", code: "<tx0C00000000038C26>" }, { name: "西格玛", code: "<tx0C00000000038C27>" }, { name: "查莉娅", code: "<tx0C00000000038C28>" }, { name: "艾什", code: "<tx0C00000000038C29>" }, { name: "堡垒", code: "<tx0C00000000038C2A>" }, { name: "麦克雷", code: "<tx0C00000000038C2B>" }, { name: "回声", code: "<tx0C0000000003849D>" }, { name: "源氏", code: "<tx0C00000000038C2C>" }, { name: "半藏", code: "<tx0C00000000038C2D>" }, { name: "狂鼠", code: "<tx0C00000000038C2E>" }, { name: "小美", code: "<tx0C00000000038C2F>" }, { name: "法拉", code: "<tx0C00000000038C30>" }, { name: "死神", code: "<tx0C00000000038C31>" }, { name: "索杰恩", code: "<tx0C00000000038C33>" }, { name: "士兵76", code: "<tx0C00000000038C34>" }, { name: "黑影", code: "<tx0C00000000038C35>" }, { name: "阿三", code: "<tx0C00000000038C36>" }, { name: "托比昂", code: "<tx0C00000000038C37>" }, { name: "黑百合", code: "<tx0C00000000038C38>" }, { name: "莫伊拉", code: "<tx0C00000000038C3A>" }, { name: "和尚", code: "<tx0C00000000038C3B>" }, { name: "闪光", code: "<tx0C00000000038C3D>" }, { name: "巴蒂", code: "<tx0C00000000038C3E>" }, { name: "布丽吉塔", code: "<tx0C00000000038C3F>" }, { name: "雾子", code: "<tx0C00000000038C40>" }, { name: "卢西奥", code: "<tx0C00000000038C41>" }, { name: "守望先锋联赛", code: "<tx0C00000000038C81>" }, { name: "未知英雄", code: "<tx0C00000000001297>" }],
                "杂项图标": [{ name: "消灭(骷髅)", code: "<tx0C000000000015BB>" }, { name: "麦克风", code: "<tx0C00000000007114>" }, { name: "金牌", code: "<tx0C0000000000797E>" }, { name: "银牌", code: "<tx0C0000000000797C>" }, { name: "铜牌", code: "<tx0C0000000000797D>" }, { name: "游戏货币", code: "<tx0C00000000008E02>" }, { name: "工坊图标", code: "<tx0C0000000001FEE9>" }, { name: "准备就绪", code: "<tx0C000000000039DB>" }, { name: "500强(紫)", code: "<tx0C000000000190E0>" }, { name: "500强(橙)", code: "<tx0C00000000009A2E>" }, { name: "500强(白)", code: "<tx0C0000000000A541>" }, { name: "点赞(绿)", code: "<tx0C0000000001764D>" }, { name: "体育精神(青)", code: "<tx0C0000000001764F>" }, { name: "指挥(紫)", code: "<tx0C0000000001764E>" }, { name: "竞技点", code: "<tx0C0000000000906E>" }, { name: "慈善(BCRF)", code: "<tx0C00000000017082>" }, { name: "全明星", code: "<tx0C00000000018F63>" }],
                "地图图标": [{ name: "新手教程", code: "<tx0C00000000005D1C>" }, { name: "阿努比斯", code: "<tx0C00000000005D1D>" }, { name: "监测站：直布罗陀", code: "<tx0C00000000005D1E>" }, { name: "好莱坞", code: "<tx0C00000000005D1F>" }, { name: "花村", code: "<tx0C00000000005D20>" }, { name: "国王大道", code: "<tx0C00000000005D21>" }, { name: "多拉多", code: "<tx0C00000000005D22>" }, { name: "沃斯卡娅工业区", code: "<tx0C00000000005D24>" }, { name: "漓江塔", code: "<tx0C00000000005D28>" }, { name: "伊利奥斯", code: "<tx0C00000000005D29>" }, { name: "尼泊尔", code: "<tx0C00000000005D2A>" }, { name: "靶场", code: "<tx0C00000000007417>" }, { name: "艾兴瓦尔德", code: "<tx0C0000000000A214>" }, { name: "绿洲城", code: "<tx0C0000000000BF72>" }, { name: "渣客镇", code: "<tx0C0000000000F302>" }, { name: "暴雪世界", code: "<tx0C00000000012B71>" }, { name: "里阿尔托", code: "<tx0C00000000013EC2>" }, { name: "釜山", code: "<tx0C00000000017629>" }, { name: "巴黎", code: "<tx0C000000000191C5>" }, { name: "哈瓦那", code: "<tx0C0000000001ED2B>" }],
                "操作图标": [{ name: "鼠标左键", code: "<tx0C0000000000447F>" }, { name: "鼠标右键", code: "<tx0C00000000004480>" }, { name: "鼠标中键", code: "<tx0C00000000005DAD>" }, { name: "滚轮上", code: "<tx0C00000000005DA0>" }, { name: "滚轮下", code: "<tx0C00000000005DA1>" }, { name: "左摇杆", code: "<tx0C000000000044A7>" }, { name: "右摇杆", code: "<tx0C000000000044A8>" }, { name: "十字键上", code: "<tx0C000000000044A6>" }, { name: "十字键下", code: "<tx0C000000000044B3>" }, { name: "十字键左", code: "<tx0C000000000044B4>" }, { name: "十字键右", code: "<tx0C000000000044A5>" }]
            };

            const segmentList = document.getElementById('segment-list'), randomTextInput = document.getElementById('random-text-input'), generateBtn = document.getElementById('generate-btn'), emojiBtn = document.getElementById('emoji-btn'), outputText = document.getElementById('output-text'), copyStatus = document.getElementById('copy-status'), colorModal = document.getElementById('color-modal'), colorModalClose = document.getElementById('color-modal-close'), colorGrid = document.getElementById('color-grid'), customColorPicker = document.getElementById('custom-color-picker'), customColorCode = document.getElementById('custom-color-code'), emojiModal = document.getElementById('emoji-modal'), emojiModalClose = document.getElementById('emoji-modal-close'), emojiTabs = document.getElementById('emoji-tabs'), emojiPanels = document.getElementById('emoji-panels');

            let currentMode = 'custom', activeInput = null, activeColorSwatch = null, segmentCounter = 0, selectionRange = null;

            const createSegmentRow = (isFirst = false) => {
                segmentCounter++;
                const row = document.createElement('div');
                row.className = 'segment-row';
                row.id = `segment-row-${segmentCounter}`;
                const defaultColor = presetColorValues[0];
                row.innerHTML = `<input type="checkbox" class="segment-checkbox" ${isFirst ? 'checked' : ''}><div class="color-swatch" style="background-color: #${defaultColor};" data-color="${defaultColor}"></div><div class="text-input" contenteditable="true" style="color: #${defaultColor};" placeholder="输入文字..."></div><div class="segment-actions"><button class="add-btn">+</button>${!isFirst ? '<button class="remove-btn">-</button>' : ''}</div>`;
                segmentList.appendChild(row);
                updateRemoveButtons();
            };

            const updateRemoveButtons = () => {
                const rows = segmentList.querySelectorAll('.segment-row');
                rows.forEach(row => { let removeBtn = row.querySelector('.remove-btn'); if (rows.length > 1) { if (!removeBtn) { const actions = row.querySelector('.segment-actions'); removeBtn = document.createElement('button'); removeBtn.className = 'remove-btn'; removeBtn.textContent = '-'; actions.appendChild(removeBtn); } } else { if (removeBtn) removeBtn.remove(); } });
            };

            const showNotification = (message, isError = false) => {
                copyStatus.textContent = message;
                copyStatus.style.color = isError ? 'var(--secondary-color)' : 'var(--tertiary-color)';
                setTimeout(() => copyStatus.textContent = '', 2000);
            };

            const generateAndCopy = () => {
                let rawString = '', htmlString = '';

                if (currentMode === 'custom') {
                    segmentList.querySelectorAll('.segment-row').forEach(row => {
                        const checkbox = row.querySelector('.segment-checkbox'), inputDiv = row.querySelector('.text-input'), swatch = row.querySelector('.color-swatch');
                        let textContent = '';
                        inputDiv.childNodes.forEach(node => { textContent += node.nodeType === 3 ? node.textContent : (node.dataset.code || ''); });
                        if (checkbox.checked && textContent.trim() !== '') {
                            const color = swatch.dataset.color;
                            rawString += `<FG${color}FF>${textContent}`;
                            htmlString += `<span style="color: #${color}">${inputDiv.innerHTML}</span>`;
                        }
                    });
                } else { // random mode
                    const getRandomColor = () => presetColorValues[Math.floor(Math.random() * presetColorValues.length)];
                    randomTextInput.childNodes.forEach(node => {
                        if (node.nodeType === 3) { // Text node
                            for (const char of node.textContent) {
                                const color = getRandomColor();
                                rawString += `<FG${color}FF>${char}`;
                                htmlString += `<span style="color: #${color}">${char.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</span>`;
                            }
                        } else if (node.nodeType === 1 && node.dataset.code) { // Emoji span
                            rawString += node.dataset.code;
                            htmlString += node.outerHTML;
                        }
                    });
                }

                outputText.innerHTML = htmlString;
                if (rawString) { navigator.clipboard.writeText(rawString).then(() => showNotification('已复制到剪贴板！')).catch(err => { showNotification('复制失败...', true); console.error('Clipboard error:', err); }); }
                else { showNotification('没有内容可生成', true); }
            };

            const insertEmoji = (code) => {
                if (!activeInput) return;
                activeInput.focus();
                const sel = window.getSelection();
                if (sel.rangeCount > 0) {
                    const range = selectionRange || sel.getRangeAt(0);
                    range.deleteContents();
                    const emojiNode = document.createElement('span');
                    emojiNode.className = 'emoji-code-inline';
                    emojiNode.setAttribute('contenteditable', 'false');
                    emojiNode.dataset.code = code;
                    emojiNode.textContent = code;
                    range.insertNode(emojiNode);
                    range.setStartAfter(emojiNode);
                    range.collapse(true);
                    sel.removeAllRanges();
                    sel.addRange(range);
                }
            };

            const initColorPicker = () => { for (const [name, hex] of Object.entries(presetColors)) { const div = document.createElement('div'); div.className = 'preset-color'; div.innerHTML = `<div class="preset-color-box" style="background-color: #${hex};" data-hex="${hex}"></div><span>${name}</span>`; colorGrid.appendChild(div); } };
            const initEmojiPicker = () => { Object.keys(emojis).forEach((category, index) => { const tab = document.createElement('div'); tab.className = 'emoji-tab'; tab.dataset.category = category; tab.textContent = category; emojiTabs.appendChild(tab); const panel = document.createElement('div'); panel.className = 'emoji-panel'; panel.id = `panel-${category}`; emojis[category].forEach(emoji => { const item = document.createElement('div'); item.className = 'emoji-item'; item.dataset.code = emoji.code; item.innerHTML = `${emoji.name}<span class="emoji-code">${emoji.code}</span>`; panel.appendChild(item); }); emojiPanels.appendChild(panel); if (index === 0) { tab.classList.add('active'); panel.classList.add('active'); } }); };

            // --- Event Listeners ---
            document.querySelector('.mode-tabs').addEventListener('click', (e) => {
                if (e.target.classList.contains('mode-tab') && !e.target.classList.contains('active')) {
                    document.querySelectorAll('.mode-tab, .mode-panel').forEach(el => el.classList.remove('active'));
                    currentMode = e.target.dataset.mode;
                    e.target.classList.add('active');
                    document.getElementById(`${currentMode}-mode-panel`).classList.add('active');
                    activeInput = currentMode === 'custom' ? segmentList.querySelector('.text-input') : randomTextInput;
                }
            });

            document.body.addEventListener('focusin', (e) => {
                if (e.target.classList.contains('text-input')) {
                    const row = e.target.closest('.segment-row');
                    if (row) {
                        document.querySelectorAll('.segment-row.active-row').forEach(r => r.classList.remove('active-row'));
                        row.classList.add('active-row');
                    }
                    activeInput = e.target;
                }
            });

            document.body.addEventListener('focusout', (e) => {
                if (e.target.classList.contains('text-input')) {
                    const sel = window.getSelection();
                    if (sel.rangeCount > 0) selectionRange = sel.getRangeAt(0);
                    const row = e.target.closest('.segment-row');
                    if (row) row.classList.remove('active-row');
                }
            });

            document.body.addEventListener('keydown', (e) => { if (e.key === 'Enter' && !e.shiftKey && e.target.classList.contains('text-input')) { e.preventDefault(); generateAndCopy(); } });

            segmentList.addEventListener('click', (e) => { if (e.target.classList.contains('add-btn')) createSegmentRow(); if (e.target.classList.contains('remove-btn')) { e.target.closest('.segment-row').remove(); updateRemoveButtons(); } if (e.target.classList.contains('color-swatch')) { activeColorSwatch = e.target; colorModal.style.display = 'block'; } });
            generateBtn.addEventListener('click', generateAndCopy);
            emojiBtn.addEventListener('click', () => { if (!activeInput) { (currentMode === 'custom' ? segmentList.querySelector('.text-input') : randomTextInput).focus(); } emojiModal.style.display = 'block'; });

            colorModalClose.addEventListener('click', () => colorModal.style.display = 'none');
            const applyColor = (hex) => { if (activeColorSwatch) { activeColorSwatch.style.backgroundColor = `#${hex}`; activeColorSwatch.dataset.color = hex; const inputDiv = activeColorSwatch.closest('.segment-row').querySelector('.text-input'); if (inputDiv) inputDiv.style.color = `#${hex}`; } };
            colorGrid.addEventListener('click', (e) => { const box = e.target.closest('.preset-color-box'); if (box) { applyColor(box.dataset.hex); colorModal.style.display = 'none'; } });
            customColorPicker.addEventListener('input', () => { const hex = customColorPicker.value.substring(1); customColorCode.textContent = `#${hex}`; applyColor(hex); });

            emojiModalClose.addEventListener('click', () => emojiModal.style.display = 'none');
            emojiTabs.addEventListener('click', (e) => { if (e.target.classList.contains('emoji-tab')) { const category = e.target.dataset.category; document.querySelectorAll('.emoji-tab, .emoji-panel').forEach(el => el.classList.remove('active')); e.target.classList.add('active'); document.getElementById(`panel-${category}`).classList.add('active'); } });
            emojiPanels.addEventListener('click', (e) => { const item = e.target.closest('.emoji-item'); if (item) { insertEmoji(item.dataset.code); emojiModal.style.display = 'none'; } });

            window.addEventListener('click', (e) => { if (e.target == colorModal) colorModal.style.display = 'none'; if (e.target == emojiModal) emojiModal.style.display = 'none'; });

            // --- Initialization ---
            createSegmentRow(true); initColorPicker(); initEmojiPicker();
            activeInput = segmentList.querySelector('.text-input'); // Set initial active input
        });
    </script>
</body>

</html>